<!DOCTYPE html>
<html style="width: 350px; min-height: 427px">

<head>
    <script src="js-libs/jquery-3.4.1.min.js"></script>
    <script src="js-libs/popper.min.js"></script>
    <script src="bootstrap-4.4.1-dist\js\bootstrap.bundle.min.js"></script>
    <script src="js-libs/clipboard.min.js"></script>
    <script src="js-libs/uuidv4.min.js"></script>
    <script src="js-libs/vue.dev.js"></script>
    <script src="popup.js"></script>
    <link rel="stylesheet" href="bootstrap-4.4.1-dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }

        html {
            border-radius: 30px;
        }

        .brand-header {
            background: linear-gradient(to bottom right, #ff9494 0%, #ee64f6 100%);
            color: white;
        }
    </style>
</head>

<body class="bg-light">
    <h3 class="text-white mt-0 p-4 text-center font-weight-bold brand-header">Jelly Party</h3>
    <div id="partyOverview" class="p-2">
        <div v-if="mainPage">
            <button v-if="isActive" type="button" class="btn btn-secondary btn-lg btn-block" data-toggle="modal"
                data-target="#leave-party-modal">Leave current party</button>
            <button v-else type="button" class="btn btn-secondary btn-lg btn-block mt-2" data-toggle="modal"
                data-target="#start-party-modal">Start a new party</button>
            <button v-if="!isActive" type="button" class="btn btn-secondary btn-lg btn-block mt-2" data-toggle="modal"
                data-target="#rejoin-party-modal">Rejoin last party</button>
            <p v-if="!isActive" class="text-center mt-3">or join an existing party by ID</p>
            <div v-if="!isActive" class="input-group mb-3 mt-3">
                <input type="text" class="form-control" placeholder="Party ID" aria-label="Party ID"
                    aria-describedby="button-party-id" id="party-join-textarea">
                <div class="input-group-append mb-5">
                    <button class="btn btn-outline-secondary" type="button" data-toggle="modal"
                        data-target="#join-party-modal">Join existing party</button>
                </div>
            </div>

            <div v-if="isActive" class="mb-5">
                <h3 class="text- mt-4 text-center">Current party <svg data-toggle="tooltip" data-placement="top"
                        title="Share this Party-Id to allow people to join your party" class="bi bi-question-fill"
                        width="1em" height="1em" viewBox="0 0 20 20" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.57 8.033H7.25C7.22 6.147 8.68 5.5 10.006 5.5c1.397 0 2.673.73 2.673 2.24 0 1.08-.635 1.594-1.244 2.057-.737.559-1.01.768-1.01 1.486v.355H9.117l-.007-.463c-.038-.927.495-1.498 1.168-1.987.59-.444.965-.736.965-1.371 0-.825-.628-1.168-1.314-1.168-.901 0-1.358.603-1.358 1.384zm1.251 6.443c-.584 0-1.009-.394-1.009-.927 0-.552.425-.94 1.01-.94.609 0 1.028.388 1.028.94 0 .533-.42.927-1.029.927z"
                            clip-rule="evenodd"></path>
                    </svg></h3>
                <div v-if="websiteIsTested" class="input-group">
                    <div class="input-group-append">
                        <span class="input-group-text" id="magicLink-link-textarea" style="font-size: 11px; width: 60vw; overflow:hidden">
                            {{ magicLink }}</span>
                        <button class="btn btn-outline-secondary" type="button" id="button-copy"
                            data-clipboard-target="#magicLink-link-textarea">Copy Magic Link</button>
                    </div>
                </div>
                <div v-else class="input-group mt-3">
                    <div class="input-group-append">
                        <span class="input-group-text text-break text-wrap" id="current-party-textarea" style="width: 65vw; overflow:hidden">
                            {{ partyId }} </span>
                        <button class="btn btn-outline-secondary" type="button" id="button-copy"
                            data-clipboard-target="#current-party-textarea">Copy Party Id</button>
                    </div>
                </div>
                <table class="table table-dark table-hover" id="sessionTable">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">User</th>
                            <th scope="col">Currently on</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(remotePeer, index) in peers">
                            <th scope="row"> {{ index + 1 }}</th>
                            <td> {{ remotePeer.clientName }}
                            </td>
                            <td>
                                <span class="badge badge-pill badge-secondary">
                                    {{ remotePeer.currentlyWatching }}
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <a v-on:click="toggleOptions" v-if="!isActive">
                <div style="position: absolute; bottom: 15px; left:15px" class="btn m-0 p-0">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" height="16px" fill="gray">
                        <path
                            d="M610.5 373.3c2.6-14.1 2.6-28.5 0-42.6l25.8-14.9c3-1.7 4.3-5.2 3.3-8.5-6.7-21.6-18.2-41.2-33.2-57.4-2.3-2.5-6-3.1-9-1.4l-25.8 14.9c-10.9-9.3-23.4-16.5-36.9-21.3v-29.8c0-3.4-2.4-6.4-5.7-7.1-22.3-5-45-4.8-66.2 0-3.3.7-5.7 3.7-5.7 7.1v29.8c-13.5 4.8-26 12-36.9 21.3l-25.8-14.9c-2.9-1.7-6.7-1.1-9 1.4-15 16.2-26.5 35.8-33.2 57.4-1 3.3.4 6.8 3.3 8.5l25.8 14.9c-2.6 14.1-2.6 28.5 0 42.6l-25.8 14.9c-3 1.7-4.3 5.2-3.3 8.5 6.7 21.6 18.2 41.1 33.2 57.4 2.3 2.5 6 3.1 9 1.4l25.8-14.9c10.9 9.3 23.4 16.5 36.9 21.3v29.8c0 3.4 2.4 6.4 5.7 7.1 22.3 5 45 4.8 66.2 0 3.3-.7 5.7-3.7 5.7-7.1v-29.8c13.5-4.8 26-12 36.9-21.3l25.8 14.9c2.9 1.7 6.7 1.1 9-1.4 15-16.2 26.5-35.8 33.2-57.4 1-3.3-.4-6.8-3.3-8.5l-25.8-14.9zM496 400.5c-26.8 0-48.5-21.8-48.5-48.5s21.8-48.5 48.5-48.5 48.5 21.8 48.5 48.5-21.7 48.5-48.5 48.5zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm201.2 226.5c-2.3-1.2-4.6-2.6-6.8-3.9l-7.9 4.6c-6 3.4-12.8 5.3-19.6 5.3-10.9 0-21.4-4.6-28.9-12.6-18.3-19.8-32.3-43.9-40.2-69.6-5.5-17.7 1.9-36.4 17.9-45.7l7.9-4.6c-.1-2.6-.1-5.2 0-7.8l-7.9-4.6c-16-9.2-23.4-28-17.9-45.7.9-2.9 2.2-5.8 3.2-8.7-3.8-.3-7.5-1.2-11.4-1.2h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c10.1 0 19.5-3.2 27.2-8.5-1.2-3.8-2-7.7-2-11.8v-9.2z" />
                    </svg>
                </div>
            </a>
            <div v-else style="position: absolute; bottom: 15px; left:15px; font-size: 0.7em" class="m-0 p-0">
                <svg class="bi bi-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                    v-bind:style="[websiteIsTested ? {fill: 'green'} : {fill: '#ffc107'}]"
                    xmlns="http://www.w3.org/2000/svg">
                    <circle cx="8" cy="8" r="8" />
                </svg>
                {{websiteIsTested ? "Website supported" : "Website experimental"}}
            </div>
            <div v-if="isActive" style="position: absolute; bottom: 15px; right: 15px; font-size: 0.7em">
                {{ websocketConnection ? "Connected to server" : "Connection error." }}
                <svg class="bi bi-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                    v-bind:style="[websocketConnection ? {fill: 'green'} : {fill: 'red'}]"
                    xmlns="http://www.w3.org/2000/svg">
                    <circle cx="8" cy="8" r="8" />
                </svg>
            </div>

            <!-- New Party Modal -->
            <div class="modal fade" id="start-party-modal" tabindex="-1" role="dialog"
                aria-labelledby="start-party-modal" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Start a new party</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure that you want to start a new party?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                v-on:click="startParty">Start
                                new party</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Join Party Modal -->
            <div class="modal fade" id="join-party-modal" tabindex="-1" role="dialog" aria-labelledby="join-party-modal"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Join a party</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure that you want to join another party?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                v-on:click="joinParty">Join
                                party</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Rejoin Party Modal -->
            <div class="modal fade" id="rejoin-party-modal" tabindex="-1" role="dialog"
                aria-labelledby="rejoin-party-modal" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Rejoin last party?</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure that you want to rejoin the last party with the following Party-Id?<br />
                            {{lastPartyId}}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                v-on:click="rejoinParty">Yes</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Leave Party Modal -->
            <div class="modal fade" id="leave-party-modal" tabindex="-1" role="dialog"
                aria-labelledby="leave-party-modal" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Leave current party</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            You are currently inside a party. Are you sure that you want to leave this party?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal"
                                v-on:click="leaveParty">Leave
                                this party</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div v-else>
            <div class="container">
                <!-- As a heading -->
                <div class="row align-items-center">
                    <div class="col">
                        <h2 class="mb-3">Options</h2>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Username</span>
                            </div>
                            <input type="text" class="form-control" required
                                placeholder="Your username will be displayed in the Party" id="usernameTextfield"
                                aria-label="Your username will be displayed in the Party"
                                aria-describedby="button-addon2" v-bind:value="name">
                        </div>
                        <button v-on:click="saveOptions" type="button" class="btn btn-secondary btn-lg btn-block mt-3"
                            id="button-save-options" data-toggle="collapse" href="#collapseExample">Save
                            changes </button>
                        <button v-on:click="toggleOptions" type="button" class="btn btn-secondary btn-lg btn-block mt-3"
                            id="button-go-back">Go
                            Back</button>
                        <div class="collapse" id="collapseExample">
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Success</h5>
                                    <p class="card-text">Changes have been saved successfully.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>